bundle:
  name: bronze-silver-gold-pipeline

# Define variables used for warehouse and catalog
variables:
  warehouse_id:
    description: "Databricks SQL warehouse ID"
    default: ""
  catalog:
    description: "Catalog name for this deployment"
    default: "analytics_dev"

# Targets (dev and prod)
targets:
  dev:
    mode: development
    default: true
    # Do NOT interpolate environment variables here
    # They are picked up automatically from environment at runtime
    workspace:
      root_path: "/Workspace/Users/utkarshs8028@gmail.com/.bundle/${bundle.name}/dev"
    variables:
      warehouse_id: ${var.warehouse_id}
      catalog: analytics_dev

  prod:
    mode: production
    workspace:
      root_path: "/Workspace/Users/utkarshs8028@gmail.com/.bundle/${bundle.name}/prod"
    variables:
      warehouse_id: ${var.warehouse_id}
      catalog: analytics_prod

# Workspace section (no host/token here)
workspace:
  # Leave host and token out completely
  root_path: "/Workspace/Users/utkarshs8028@gmail.com/.bundle/${bundle.name}/${bundle.target}"

resources:
  jobs:
    bronze_silver_gold_job:
      name: bronze_silver_gold_job

      trigger:
        periodic:
          interval: 1
          unit: DAYS

      tasks:
        - task_key: init_catalog
          sql_task:
            file:
              path: sql/init_catalog.sql
            warehouse_id: ${var.warehouse_id}

        - task_key: bronze_ingestion
          depends_on:
            - task_key: init_catalog
          notebook_task:
            notebook_path: notebooks/bronze_ingestion.ipynb

        - task_key: silver_transform
          depends_on:
            - task_key: bronze_ingestion
          notebook_task:
            notebook_path: notebooks/silver_transform.ipynb

        - task_key: gold_aggregate
          depends_on:
            - task_key: silver_transform
          notebook_task:
            notebook_path: notebooks/gold_aggregate.ipynb
