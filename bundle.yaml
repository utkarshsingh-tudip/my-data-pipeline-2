bundle:
  name: bronze-silver-gold-pipeline

resources:
  jobs:
    bronze_silver_gold_job:
      name: bronze_silver_gold_job

      trigger:
        # Run once per day
        periodic:
          interval: 1
          unit: DAYS

      tasks:
        # 1️⃣ SQL task: create catalog and schemas
        - task_key: init_catalog
          sql_task:
            file:
              path: sql/init_catalog.sql
            warehouse_id: ${warehouse_id}  #12f8143d70dbe939
          # No depends_on, runs first

        # 2️⃣ Bronze ingestion notebook
        - task_key: bronze_ingestion
          depends_on:
            - task_key: init_catalog
          notebook_task:
            notebook_path: notebooks/bronze_ingestion.ipynb

        # 3️⃣ Silver transformation notebook
        - task_key: silver_transform
          depends_on:
            - task_key: bronze_ingestion
          notebook_task:
            notebook_path: notebooks/silver_transform.ipynb

        # 4️⃣ Gold aggregation notebook
        - task_key: gold_aggregate
          depends_on:
            - task_key: silver_transform
          notebook_task:
            notebook_path: notebooks/gold_aggregate.ipynb

      environments:
        - environment_key: default
          spec:
            environment_version: "2"
            dependencies: []
