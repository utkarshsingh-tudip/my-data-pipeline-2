bundle:
  name: bronze-silver-gold-pipeline

targets:
  dev:
    mode: development
    default: true
    workspace:
      host: ${env.DATABRICKS_HOST}
    variables:
      warehouse_id: ${var.warehouse_id}
      catalog: analytics_dev

  prod:
    mode: production
    workspace:
      host: ${env.DATABRICKS_PROD_HOST}
    variables:
      warehouse_id: ${var.warehouse_id}
      catalog: analytics_prod

resources:
  jobs:
    bronze_silver_gold_job:
      name: bronze_silver_gold_job

      trigger:
        periodic:
          interval: 1
          unit: DAYS

      tasks:
        - task_key: init_catalog
          sql_task:
            file:
              path: sql/init_catalog.sql
            warehouse_id: ${warehouse_id}  #12f8143d70dbe939

        - task_key: bronze_ingestion
          depends_on:
            - task_key: init_catalog
          notebook_task:
            notebook_path: notebooks/bronze_ingestion.ipynb

        - task_key: silver_transform
          depends_on:
            - task_key: bronze_ingestion
          notebook_task:
            notebook_path: notebooks/silver_transform.ipynb

        - task_key: gold_aggregate
          depends_on:
            - task_key: silver_transform
          notebook_task:
            notebook_path: notebooks/gold_aggregate.ipynb

      environments:
        - environment_key: default
          spec:
            environment_version: "2"
            dependencies: []
